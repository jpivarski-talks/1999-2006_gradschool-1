#!/usr/local/bin/perl

%lumi = (
	 122536 => [1296.2, 10.3],
	 122537 => [1336.0, 10.4],
	 122538 => [1292.9, 10.2],
	 122539 => [1300.5, 10.3],
	 122540 => [1225.4, 10.0],
	 122541 => [1213.0, 9.9],
	 122542 => [1129.7, 9.6],
	 122545 => [1165.6, 9.7],
	 122546 => [163.5, 3.6],
	 122548 => [1126.5, 9.6],
	 122549 => [1383.6, 10.6],
	 122550 => [1301.9, 10.3],
	 122551 => [1314.1, 10.3],
	 122555 => [844.7, 8.3],
	 122556 => [870.3, 8.4],
	 122557 => [853.5, 8.3],
	 122559 => [1175.9, 9.8],
	 122560 => [1140.3, 9.6],
	 122562 => [1114.4, 9.5],
	 122563 => [1088.6, 9.4],
	 122564 => [1252.0, 10.1],
	 122567 => [60.6, 2.2],
	 122568 => [1057.3, 9.3],
	 122569 => [924.2, 8.7],
	 122570 => [1676.7, 11.7],
	 122571 => [1645.6, 11.5],
	 122572 => [1725.4, 11.8],
	 122573 => [1737.6, 11.9],
	 122574 => [1301.5, 10.3],
	 122575 => [1189.6, 9.8],
	 122576 => [362.5, 5.4],
	 122577 => [1314.9, 10.3],
	 122578 => [109.3, 3.0],
	 122579 => [442.6, 6.0],
	 122585 => [1675.7, 11.7],
	 122586 => [1670.6, 11.6],
	 122587 => [1660.5, 11.6],
	 122590 => [1415.6, 10.7],
	 122593 => [685.9, 7.5],
	 122594 => [755.9, 7.8],
	 122595 => [178.9, 3.8],
	 122596 => [1309.9, 10.3],
	 122599 => [419.7, 5.8],
	 122600 => [106.2, 2.9],
	 122602 => [1740.0, 11.9],
	 122603 => [1818.1, 12.1],
	 122604 => [1789.9, 12.0],
	 122605 => [1811.3, 12.1],
	 122606 => [558.7, 6.7],
	 122608 => [1769.9, 12.0],
	 122610 => [1923.4, 12.5],
	 122613 => [624.9, 7.1],
	 122614 => [2341.3, 13.8],
	 122615 => [2336.3, 13.8],
	 122616 => [2300.1, 13.7],
	 122618 => [2249.3, 13.5],
	 122619 => [2340.0, 13.8],
	 122620 => [2346.7, 13.8],
	 122622 => [203.2, 4.1],
	 122623 => [1012.8, 9.1],
	 122625 => [1662.3, 11.6],
	 122626 => [2178.6, 13.3],
	 122627 => [154.2, 3.5],
	 122628 => [525.8, 6.5],
	 122629 => [2253.8, 13.5],
	 122631 => [577.4, 6.8],
	 122632 => [658.6, 7.3],
	 122634 => [851.4, 8.3],
	 122640 => [1306.3, 10.3],
	 122641 => [2159.8, 13.2],
	 122642 => [2359.4, 13.8],
	 122643 => [2016.9, 12.8],
	 122646 => [1091.1, 9.4],
	 122647 => [891.5, 8.5],
	 122648 => [1190.9, 9.8],
	 122649 => [2331.6, 13.7],
	 122650 => [2163.6, 13.2],
	 122653 => [2387.3, 13.9],
	 122654 => [2075.0, 13.0],
	 122657 => [1260.3, 10.1],
	 122658 => [909.2, 8.6],
	 122661 => [740.9, 7.7],
	 122665 => [1663.6, 11.6],
	 122667 => [1180.8, 9.8],
	 122668 => [129.5, 3.2],
	 122669 => [176.5, 3.8],
	 122672 => [2250.7, 13.5],
	 122673 => [2303.8, 13.7],
	 );

while ( <> ) {
    chop;
    my ($run, $energy, $number) = split(/\s+/);

    $energy *= 2.;
    my $energyMeV = $energy * 1000.;

    die if ( !defined($lumi{$run}) );
    my $l = $lumi{$run}->[0];
    my $le = $lumi{$run}->[1];

    my $parent_hxc = `echo "77.05870 10.35820 4.668636 0 0.0263 $energyMeV" | ./spitout`;
    chop $parent_hxc;
    my $ups3sToEE_xc = 0.0181 * $parent_hxc;

    # in datasucker, you only used barrel bhabha luminosity
    # measurements, so that's the cross-section you'll use here. I'm
    # including the rest for completeness.
    #
    # In P1LumiMonProc.cc:
    # 	  const double k_barrelBhabhaCS ( 11.8271    ) ;
    # 	  const double k_barrelGamGamCS (  1.3948*0.988 ) ; // fac for trig losses @90deg
    # 	  const double k_endcapBhabhaCS ( 22.93  /4. ) ;
    # 	  const double k_endcapGamGamCS (  0.5721/4. ) ;
    # (these are at 5.29 GeV)
    my $bhabha_xc = 11.8271 * sqr(10580. / $energyMeV);
    my $all_ee_xc = $bhabha_xc + $ups3sToEE_xc; # I know this is an overestimate due to interference

    my $ee_count = $l * 11.8271 * sqr(10580. / $energyMeV);
    my $true_l = $ee_count / $all_ee_xc;
    my $true_le = $true_l / sqrt($ee_count);

    my $hxc = $number / $true_l;
    my $hxce = $hxc * sqrt(1/$number + ($true_le/$true_l)*($true_le/$true_l));

    print("$energy $hxc $hxce\n");
}

sub sqr { return $_[0] * $_[0]; }
