<< Statistics`ContinuousDistributions`

WeightedSum[ points:{ { ( _Integer | _Real ), ( _Integer | _Real ) } .. } ] :=
    { Plus @@ (#[[1]]& /@ points), Sqrt[ Plus @@ ((#[[2]]^2)& /@ points) ] };

y1sgoal = Plus @@ (#[[2]]& /@ ReadList["y1s_high.bgxs", {Real, Real}]);
y2sgoal = Plus @@ (#[[2]]& /@ ReadList["y2s_high.bgxs", {Real, Real}]);
y3sgoal = Plus @@ (#[[2]]& /@ ReadList["y3s_high.bgxs", {Real, Real}]);

{y1sgoal, y2sgoal, y3sgoal}

Out[4]= {0.444005, 0.186354, 0.406892}

y1scont = Sort[ReadList["y1s_cont.bgxs", {Real, Real}], (#1[[1]] < #2[[1]])&];
y2scont = Sort[ReadList["y2s_cont.bgxs", {Real, Real}], (#1[[1]] < #2[[1]])&];
y3scont = Sort[ReadList["y3s_cont.bgxs", {Real, Real}], (#1[[1]] < #2[[1]])&];
y1speak = Sort[ReadList["y1s_peak.bgxs", {Real, Real}], (#1[[1]] < #2[[1]])&];
y2speak = Sort[ReadList["y2s_peak.bgxs", {Real, Real}], (#1[[1]] < #2[[1]])&];
y3speak = Sort[ReadList["y3s_peak.bgxs", {Real, Real}], (#1[[1]] < #2[[1]])&];

Plot[CDF[ExponentialDistribution[100], x], {x, 0, 0.5}, PlotRange -> {0, 1}];

InitialConf[data_] := Table[0, {Length[data]}];
ConfSum[data_, conf_] := Plus @@ (#[[2]]& /@ (data * conf));
ChangeConf1[conf_] := Module[{i = Random[Integer, Length[conf]-1]+1},
			     ReplacePart[conf, 1 - conf[[i]], i]];
FindOnes[conf_] := Flatten[Table[If[conf[[i]] == 1, {i}, {}], {i, 1, Length[conf]}], 1];
FindZeros[conf_] := Flatten[Table[If[conf[[i]] == 0, {i}, {}], {i, 1, Length[conf]}], 1];
RandElem[list_] := list[[Random[Integer, Length[list]-1]+1]];
ChangeConf2[conf_] := Module[{i = RandElem[FindOnes[conf]],
			      j = RandElem[FindZeros[conf]]},
			     ReplacePart[ReplacePart[conf, 1 - conf[[i]], i], 1 - conf[[j]], j]];
ChangeConf[conf_] := If[(Plus @@ conf) > 0  &&  Random[Integer] == 0,
			ChangeConf2[conf],
			ChangeConf1[conf]];
ConfRuns[data_, conf_] := (Print[TableForm[Select[data * conf, (# != {0, 0})&]]];
			   Print[]; Print["-------------------"]; Print[];
			   Print["          ", ConfSum[data, conf]];);
ListFromConf[data_, conf_] := #[[1]]& /@ Select[data * conf, (# != {0, 0})&];
GapsWeight[list_] := If[Length[list] < 3, 0,
			3./Sum[Abs[list[[i+1]] - list[[i]]], {i, 1, Length[list]-1}]];
RangeFilled[range_, list_] := Or @@ ((# >= range[[1]] && # <= range[[2]])& /@ list);
RangesFilled[ranges_, list_] := And @@ (RangeFilled[#, list]& /@ ranges);
FindBest[data_, goal_, ranges_, init_] := 
    Module[{lastconf, lastval, lastinranges, newconf, newval, newinranges,
	    fall, grope, outplot},
	   lastconf = If[init == {}, InitialConf[data], init];
	   lastval = Abs[ConfSum[data, lastconf] - goal]; (* + GapsWeight[ListFromConf[data, lastconf]]; *)
	   lastinranges = If[ranges == {}, True, RangesFilled[ranges, ListFromConf[data, lastconf]]];
	   While[lastval > 0.0001, (
	       newconf = ChangeConf[lastconf];
	       newval = Abs[ConfSum[data, newconf] - goal]; (* + GapsWeight[ListFromConf[data, lastconf]]; *)
	       newinranges = If[ranges == {}, True, RangesFilled[ranges, ListFromConf[data, newconf]]];
	       fall = newval < lastval;
	       grope = If[fall, False, Random[ExponentialDistribution[100]] > (newval - lastval)];
	       Print[lastval, " ", newval, " ", newinranges, " ", fall, " ", grope];
	       If[(newinranges || !lastinranges) && (fall || grope),
		  {lastval = newval, lastconf = newconf, lastinranges = newinranges}];
				   )];
	   ConfRuns[data, lastconf];
	   outplot = Table[{i, data[[i, 1]]}, {i, 1, Length[data]}];
	   Show[ListPlot[outplot,
			 AspectRatio -> 3,
			 DisplayFunction -> Identity],
		ListPlot[Select[outplot * lastconf, (# != {0, 0})&],
			 PlotStyle -> RGBColor[1, 0, 0],
			 DisplayFunction -> Identity],
		DisplayFunction -> $DisplayFunction];
	   #[[1]]& /@ Select[data * lastconf, (# != {0, 0})&]];
ConfFromList[data_, list_] := If[MemberQ[list, #[[1]]], 1, 0]& /@ data;











                                FIRST THE THREE-S!!!!

FindBest[y3scont, y3sgoal]

122080.   0.0640933
122081.   0.0624708
122268.   0.0532931
122420.   0.0409043
122427.   0.0526649
122585.   0.0522888
122789.   0.0379257
122810.   0.0432392
-------------------
          0.40688

Out[570]= {122080., 122081., 122268., 122420., 122427., 122585., 122789., 122810.}

Additionally, we want enough to have two from each group.

These are all the runs:
    122080 122081 122091
    122268 122269 122273
    122418 122420 122423 122424 122425 122426 122427 122428 122430 122432
    122585 122586 122587
    122602 122603 122604 122605
    122789
    122796 122797 122798 122799 122800 122801 122802 122803 122804 122805
    122810
    123018

These are the ones to take for luminosity studies:
    122080 122081
    122268 122273
    122420 122427
    122585 122587
    122603 122604
    122789
    122799 122803
    122810
    123018

This is the luminosity for those:

    122080 1518.1 32.6 38.0
    122081 1714.4 34.6 42.9
    122268 1655.0 34.0 41.4
    122273 1791.2 35.4 44.8
    122420 1694.2 34.4 42.4
    122427 1581.7 33.2 39.5
    122585 1673.4 34.2 41.8
    122587 1623.9 33.7 40.6
    122603 1815.3 35.6 45.4
    122604 1707.7 34.5 42.7
    122789 1550.4 32.9 38.8
    122799 1725.1 34.7 43.1
    122803 1814.6 35.6 45.4
    122810 1618.9 33.6 40.5
    123018 1662.9 34.1 41.6

WeightedSum[{{1518.1, 32.6},
	     {1714.4, 34.6},
	     {1655.0, 34.0},
	     {1791.2, 35.4},
	     {1694.2, 34.4},
	     {1581.7, 33.2},
	     {1673.4, 34.2},
	     {1623.9, 33.7},
	     {1815.3, 35.6},
	     {1707.7, 34.5},
	     {1550.4, 32.9},
	     {1725.1, 34.7},
	     {1814.6, 35.6},
	     {1618.9, 33.6},
	     {1662.9, 34.1}}]

Out[575]= {25146.8, 132.526}

132.526/25146.8

Out[577]= 0.00527009



The y3speak goal needs to add up to *all* the continuum, not just
those that add up to high.

y3speakgoal = ConfSum[y3scont,
		      ConfFromList[y3scont, {122080., 122081., 122268., 122273.,
					     122420., 122427., 122585., 122587.,
					     122603., 122604., 122789., 122799.,
					     122803., 122810., 123018.}]]

Out[8]= 0.72673

y3sranges = {{121917., 121974.}, {122079., 122147.}, {122274., 122323.}, {122440., 122473.},
	     {122608., 122673.}, {122812., 122860.}, {123021., 123065.}};

FindBest[y3speak, y3speakgoal, y3sranges]

121927.   0.0677321
122102.   0.0657393
122146.   0.0605859
122293.   0.0561245
122322.   0.0584332
122450.   0.0437741
122467.   0.0545913
122616.   0.0381679
122844.   0.0446943
122846.   0.040029
122847.   0.0378684
123041.   0.0414747
123050.   0.0369898
123055.   0.0338164
123062.   0.0466686
-------------------
          0.726689

Out[64]= {121927., 122102., 122146., 122293., 122322., 122450., 122467., 
 
>    122616., 122844., 122846., 122847., 123041., 123050., 123055., 123062.}

Here is the luminosities for those:

    122102 1991.2 37.4 49.8
    122146 1952.6 37.0 48.8
    122293 1708.7 34.6 42.7
    122322 2395.9 41.0 59.9
    122450 1998.9 37.5 50.0
    122467 2615.8 42.9 65.4
    122616 2292.5 40.1 57.3
    122844 2552.9 42.3 63.8
    122846 2763.0 44.1 69.1
    122847 2477.0 41.7 61.9
    123041 1974.7 37.2 49.4
    123050 2195.2 39.3 54.9
    123055 1511.1 32.6 37.8
    123062 2474.9 41.7 61.9
    121927 1601.9 33.5 40.0

WeightedSum[{{1991.2, 37.4},
	     {1952.6, 37.0},
	     {1708.7, 34.6},
	     {2395.9, 41.0},
	     {1998.9, 37.5},
	     {2615.8, 42.9},
	     {2292.5, 40.1},
	     {2552.9, 42.3},
	     {2763.0, 44.1},
	     {2477.0, 41.7},
	     {1974.7, 37.2},
	     {2195.2, 39.3},
	     {1511.1, 32.6},
	     {2474.9, 41.7},
	     {1601.9, 33.5}}]

Out[65]= {32506.3, 151.082}

151.082/32506.3

Out[66]= 0.00464778


                                NOW FOR THE TWO-S!!!!

FindBest[y2scont, y2sgoal, {}]

126492.   0.0289536
126665.   0.0301775
126670.   0.0235117
127626.   0.0270535
127662.   0.0271329
129065.   0.0244667
129848.   0.025033
-------------------
          0.186329

Out[68]= {126492., 126665., 126670., 127626., 127662., 129065., 129848.}

We add a few more to get significant luminosity:

    127626 1940.6 35.5 48.5
    127662 2373.5 39.2 59.3
    127700 2401.3 39.4 60.0
    126839 1601.8 32.2 40.0
    127443 1503.2 31.2 37.6
    126266 2170.5 37.5 54.3
    126492 1861.6 34.7 46.5
    126665 1762.9 33.8 44.1
    126670 1726.8 33.4 43.2
    129848 1817.6 34.3 45.4
    129713 1696.3 33.2 42.4
    129730 1544.6 31.6 38.6
    129065 2489.1 40.2 62.2

And their luminosity is:

WeightedSum[{{1940.6, 35.5},
	     {2373.5, 39.2},
	     {2401.3, 39.4},
	     {1601.8, 32.2},
	     {1503.2, 31.2},
	     {2170.5, 37.5},
	     {1861.6, 34.7},
	     {1762.9, 33.8},
	     {1726.8, 33.4},
	     {1817.6, 34.3},
	     {1696.3, 33.2},
	     {1544.6, 31.6},
	     {2489.1, 40.2}}]

Out[71]= {24889.8, 126.969}

126.969/24889.8

Out[72]= 0.00510125

y2speakgoal = ConfSum[y2scont,
		      ConfFromList[y2scont, {127626., 127662., 127700., 126839.,
					     127443., 126266., 126492., 126665.,
					     126670., 129848., 129713., 129730., 129065.}]]

Out[73]= 0.340685

FindBest[y2speak, y2speakgoal, {}]

126509.   0.0348069
126575.   0.0295748
126581.   0.0278163
126911.   0.029806
127268.   0.0246053
127273.   0.0248815
127294.   0.0260414
127317.   0.0288276
129564.   0.0263333
129632.   0.0314387
129656.   0.0308268
129660.   0.025683
-------------------
          0.340642

Out[83]= {126509., 126575., 126581., 126911., 127268., 127273., 127294., 
 
>    127317., 129564., 129632., 129656., 129660.}


And here's the luminosity:

126911 2066.7 36.7 51.7
127268 1792.3 34.2 44.8
127273 2025.6 36.3 50.6
127294 2311.7 38.8 57.8
127317 1918.3 35.4 48.0
126509 1649.1 32.8 41.2
126575 2201.2 37.9 55.0
126581 1585.4 32.1 39.6
129564 2711.4 42.0 67.8
129632 2582.8 41.0 64.6
129656 2724.9 42.1 68.1
129660 1771.6 34.0 44.3

WeightedSum[{{2066.7, 36.7},
	     {1792.3, 34.2},
	     {2025.6, 36.3},
	     {2311.7, 38.8},
	     {1918.3, 35.4},
	     {1649.1, 32.8},
	     {2201.2, 37.9},
	     {1585.4, 32.1},
	     {2711.4, 42.0},
	     {2582.8, 41.0},
	     {2724.9, 42.1},
	     {1771.6, 34.0}}]

Out[91]= {25341., 128.487}

128.487/25341.

Out[92]= 0.00507032



                                  NOW FOR THE ONE-S!!!

FindBest[y1scont, y1sgoal, {}]

123370.   0.0354326
123569.   0.0321777
123810.   0.0299177
123813.   0.0365249
123814.   0.032271
123952.   0.0387406
123958.   0.033571
124138.   0.0320122
124312.   0.0348424
124319.   0.0338164
124465.   0.0383945
124648.   0.0304231
125169.   0.0358712
-------------------
          0.443995

Out[84]= {123370., 123569., 123810., 123813., 123814., 123952., 123958., 
 
>    124138., 124312., 124319., 124465., 124648., 125169.}

These are the runs (plus a few extra for luminosity):

    125169 1639.2 30.8 41.0
    125315 1820.8 32.4 45.5
    123810 1895.2 33.1 47.4
    123813 1916.5 33.3 47.9
    123814 1995.6 33.9 49.9
    123952 1626.2 30.6 40.7
    123958 1584.7 30.2 39.6
    124114 1737.6 31.7 43.4
    124138 1836.8 32.6 45.9
    124312 1687.6 31.2 42.2
    124319 1718.1 31.5 43.0
    123370 1699.0 31.3 42.5
    123569 1566.3 30.1 39.2
    124465 1549.7 29.9 38.7
    124648 1564.6 30.0 39.1
    124665 1502.9 29.4 37.6

WeightedSum[{{1639.2, 30.8},
	     {1820.8, 32.4},
	     {1895.2, 33.1},
	     {1916.5, 33.3},
	     {1995.6, 33.9},
	     {1626.2, 30.6},
	     {1584.7, 30.2},
	     {1737.6, 31.7},
	     {1836.8, 32.6},
	     {1687.6, 31.2},
	     {1718.1, 31.5},
	     {1699.0, 31.3},
	     {1566.3, 30.1},
	     {1549.7, 29.9},
	     {1564.6, 30.0},
	     {1502.9, 29.4}}]

Out[88]= {27340.8, 125.61}

125.61/27340.8

Out[89]= 0.00459423

y1speakgoal = ConfSum[y1scont,
		      ConfFromList[y1scont, {125169., 125315., 123810., 123813.,
					     123814., 123952., 123958., 124114.,
					     124138., 124312., 124319., 123370.,
					     123569., 124465., 124648., 124665}]]

Out[93]= 0.510971

y1sranges = {{123610., 123624.},
	     {123632., 123659.},
	     {123822., 123853.},
	     {123864., 123873.},
	     {123965., 123993.},
	     {124007., 124017.},
	     {124144., 124194.},
	     {124328., 124377.},
	     {124480., 124518.},
	     {124671., 124691.},
	     {124699., 124719.},
	     {124849., 124877.},
	     {125155., 125227.},
	     {125316., 125370.}};

(* tolerence at 0.1, exponential at 10 *)
FindBest[y1speak, y1speakgoal, y1sranges, ConfFromList[y1speak, #[[1]]& /@ y1sranges]]

123610.   0.045916
123632.   0.0391886
123822.   0.0444431
123864.   0.0324331
123965.   0.0431632
124007.   0.0439405
124144.   0.0345816
124328.   0.0334608
124480.   0.0557282
124671.   0.0475131
124699.   0.0434121
124849.   0.0518461
125155.   0.0409335
125316.   0.0436327
-------------------
          0.600193

Out[118]= {123610., 123632., 123822., 123864., 123965., 124007., 124144., 
 
>    124328., 124480., 124671., 124699., 124849., 125155., 125316.}












(* tolerence at 0.01, exponential at 500 *)
FindBest[y1speak, y1speakgoal, y1sranges, ConfFromList[y1speak, Out[118]]]

123624.   0.041738
123658.   0.0384696
123833.   0.0347476
123864.   0.0324331
123991.   0.0370973
124007.   0.0439405
124174.   0.0343375
124328.   0.0334608
124513.   0.0274916
124688.   0.0403911
124701.   0.0377333
124864.   0.042623
125222.   0.038753
125366.   0.0374289
-------------------
          0.520645

Out[130]= {123624., 123658., 123833., 123864., 123991., 124007., 124174., 
 
>    124328., 124513., 124688., 124701., 124864., 125222., 125366.}

(* tolerence at 0.001, exponential at 2000 *)
FindBest[y1speak, y1speakgoal, y1sranges, ConfFromList[y1speak, Out[130]]]

123611.   0.0363972
123653.   0.0386873
123833.   0.0347476
123864.   0.0324331
123991.   0.0370973
124007.   0.0439405
124174.   0.0343375
124328.   0.0334608
124513.   0.0274916
124688.   0.0403911
124701.   0.0377333
124861.   0.0383026
125222.   0.038753
125366.   0.0374289
-------------------
          0.511202

Out[132]= {123611., 123653., 123833., 123864., 123991., 124007., 124174., 
 
>    124328., 124513., 124688., 124701., 124861., 125222., 125366.}

(* tolerence at 0.0001, exponential at 10000 *)
FindBest[y1speak, y1speakgoal, y1sranges, ConfFromList[y1speak, Out[132]]]

123611.   0.0363972
123658.   0.0384696
123833.   0.0347476
123864.   0.0324331
123991.   0.0370973
124007.   0.0439405
124174.   0.0343375
124328.   0.0334608
124513.   0.0274916
124688.   0.0403911
124701.   0.0377333
124861.   0.0383026
125222.   0.038753
125366.   0.0374289
-------------------
          0.510984

Out[134]= {123611., 123658., 123833., 123864., 123991., 124007., 124174., 
 
>    124328., 124513., 124688., 124701., 124861., 125222., 125366.}










The runs are:
    125222 1517.3 29.7 37.9
    125366 1776.7 32.1 44.4
    123833 1913.8 33.3 47.8
    123864 2266.2 36.3 56.7
    123991 1905.8 33.3 47.6
    124007 1768.3 32.0 44.2
    124174 2160.9 35.4 54.0
    124328 1778.2 32.1 44.5
    123611 1788.6 32.2 44.7
    123658 1910.6 33.3 47.8
    124513 1756.9 31.9 43.9
    124688 1871.7 33.0 46.8
    124701 2244.7 36.1 56.1
    124861 1717.9 31.6 42.9

Their luminosities are:

WeightedSum[{{1517.3, 29.7},
	     {1776.7, 32.1},
	     {1913.8, 33.3},
	     {2266.2, 36.3},
	     {1905.8, 33.3},
	     {1768.3, 32.0},
	     {2160.9, 35.4},
	     {1778.2, 32.1},
	     {1788.6, 32.2},
	     {1910.6, 33.3},
	     {1756.9, 31.9},
	     {1871.7, 33.0},
	     {2244.7, 36.1},
	     {1717.9, 31.6}}]

Out[137]= {26377.6, 123.732}

123.732/26377.6

Out[138]= 0.0046908


