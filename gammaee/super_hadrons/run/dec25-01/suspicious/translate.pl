#!/usr/local/bin/perl

%lumi = (
	 122536 => [1296.2, 10.3],
	 122537 => [1336.0, 10.4],
	 122538 => [1292.9, 10.2],
	 122539 => [1300.5, 10.3],
	 122540 => [1225.4, 10.0],
	 122541 => [1213.0, 9.9],
	 122542 => [1129.7, 9.6],
	 122545 => [1165.6, 9.7],
	 122546 => [163.5, 3.6],
	 122548 => [1126.5, 9.6],
	 122549 => [1383.6, 10.6],
	 122550 => [1301.9, 10.3],
	 122551 => [1314.1, 10.3],
	 122555 => [844.7, 8.3],
	 122556 => [870.3, 8.4],
	 122557 => [853.5, 8.3],
	 122559 => [1175.9, 9.8],
	 122560 => [1140.3, 9.6],
	 122562 => [1114.4, 9.5],
	 122563 => [1088.6, 9.4],
	 122564 => [1252.0, 10.1],
	 122567 => [60.6, 2.2],
	 122568 => [1057.3, 9.3],
	 122569 => [924.2, 8.7],
	 122570 => [1676.7, 11.7],
	 122571 => [1645.6, 11.5],
	 122572 => [1725.4, 11.8],
	 122573 => [1737.6, 11.9],
	 122574 => [1301.5, 10.3],
	 122575 => [1189.6, 9.8],
	 122576 => [362.5, 5.4],
	 122577 => [1314.9, 10.3],
	 122578 => [109.3, 3.0],
	 122579 => [442.6, 6.0],
	 122585 => [1675.7, 11.7],
	 122586 => [1670.6, 11.6],
	 122587 => [1660.5, 11.6],
	 122590 => [1415.6, 10.7],
	 122593 => [685.9, 7.5],
	 122594 => [755.9, 7.8],
	 122595 => [178.9, 3.8],
	 122596 => [1309.9, 10.3],
	 122599 => [419.7, 5.8],
	 122600 => [106.2, 2.9],
	 122602 => [1740.0, 11.9],
	 122603 => [1818.1, 12.1],
	 122604 => [1789.9, 12.0],
	 122605 => [1811.3, 12.1],
	 122606 => [558.7, 6.7],
	 122608 => [1769.9, 12.0],
	 122610 => [1923.4, 12.5],
	 122613 => [624.9, 7.1],
	 122614 => [2341.3, 13.8],
	 122615 => [2336.3, 13.8],
	 122616 => [2300.1, 13.7],
	 122618 => [2249.3, 13.5],
	 122619 => [2340.0, 13.8],
	 122620 => [2346.7, 13.8],
	 122622 => [203.2, 4.1],
	 122623 => [1012.8, 9.1],
	 122625 => [1662.3, 11.6],
	 122626 => [2178.6, 13.3],
	 122627 => [154.2, 3.5],
	 122628 => [525.8, 6.5],
	 122629 => [2253.8, 13.5],
	 122631 => [577.4, 6.8],
	 122632 => [658.6, 7.3],
	 122634 => [851.4, 8.3],
	 122640 => [1306.3, 10.3],
	 122641 => [2159.8, 13.2],
	 122642 => [2359.4, 13.8],
	 122643 => [2016.9, 12.8],
	 122646 => [1091.1, 9.4],
	 122647 => [891.5, 8.5],
	 122648 => [1190.9, 9.8],
	 122649 => [2331.6, 13.7],
	 122650 => [2163.6, 13.2],
	 122653 => [2387.3, 13.9],
	 122654 => [2075.0, 13.0],
	 122657 => [1260.3, 10.1],
	 122658 => [909.2, 8.6],
	 122661 => [740.9, 7.7],
	 122665 => [1663.6, 11.6],
	 122667 => [1180.8, 9.8],
	 122668 => [129.5, 3.2],
	 122669 => [176.5, 3.8],
	 122672 => [2250.7, 13.5],
	 122673 => [2303.8, 13.7],
	 );

%energy = (
	   122536 => 5.19045,
	   122537 => 5.17431,
	   122538 => 5.18236,
	   122539 => 5.17240,
	   122540 => 5.18535,
	   122541 => 5.18846,
	   122542 => 5.17743,
	   122545 => 5.19046,
	   122546 => 5.17451,
	   122548 => 5.17449,
	   122549 => 5.18240,
	   122550 => 5.17246,
	   122551 => 5.18554,
	   122555 => 5.18845,
	   122556 => 5.17739,
	   122557 => 5.19046,
	   122559 => 5.17432,
	   122560 => 5.18237,
	   122562 => 5.18548,
	   122563 => 5.18843,
	   122564 => 5.17742,
	   122567 => 5.19968,
	   122568 => 5.19968,
	   122569 => 5.19965,
	   122570 => 5.19968,
	   122571 => 5.19968,
	   122572 => 5.19967,
	   122573 => 5.19968,
	   122574 => 5.19974,
	   122575 => 5.19975,
	   122576 => 5.17934,
	   122577 => 5.17936,
	   122578 => 5.17952,
	   122579 => 5.17939,
	   122585 => 5.16514,
	   122586 => 5.16517,
	   122587 => 5.16517,
	   122590 => 5.16519,
	   122593 => 5.16519,
	   122594 => 5.16516,
	   122595 => 5.16516,
	   122596 => 5.16518,
	   122599 => 5.16519,
	   122600 => 5.16518,
	   122602 => 5.16518,
	   122603 => 5.16519,
	   122604 => 5.16524,
	   122605 => 5.16531,
	   122606 => 5.16528,
	   122608 => 5.17937,
	   122610 => 5.17940,
	   122613 => 5.17939,
	   122614 => 5.17942,
	   122615 => 5.17942,
	   122616 => 5.17942,
	   122617 => 5.17938,
	   122618 => 5.17942,
	   122619 => 5.17942,
	   122620 => 5.17942,
	   122622 => 5.17944,
	   122623 => 5.17945,
	   122625 => 5.17945,
	   122626 => 5.17942,
	   122627 => 5.17942,
	   122628 => 5.17942,
	   122629 => 5.17942,
	   122630 => 5.17943,
	   122631 => 5.17939,
	   122632 => 5.17949,
	   122634 => 5.17952,
	   122640 => 5.17949,
	   122641 => 5.17952,
	   122642 => 5.17952,
	   122643 => 5.17949,
	   122646 => 5.17949,
	   122647 => 5.17952,
	   122648 => 5.17949,
	   122649 => 5.17952,
	   122650 => 5.17955,
	   122653 => 5.17954,
	   122654 => 5.17952,
	   122657 => 5.17954,
	   122658 => 5.17952,
	   122661 => 5.17952,
	   122665 => 5.17954,
	   122667 => 5.17952,
	   122668 => 5.17955,
	   122669 => 5.17954,
	   122672 => 5.17954,
	   122673 => 5.17957
	   );

while (<>) {
    chop;
    my ($run, $total, $passed, $ebg, $ebg_err, $pbg, $pbg_err) = split(/\s+/);
    my $e = 2000. * $energy{$run};

#     my $hxc = ($passed - $ebg - $pbg)/$lumi{$run}->[0];
#     my $hxc_err = sqrt((&sqr($passed - $ebg - $pbg) * &sqr($lumi{$run}->[1]) /
# 			&sqr(&sqr($lumi{$run}->[0]))) +
# 		       (1./$passed + 1./$ebg + 1./$pbg) / &sqr($lumi{$run}->[0]));

    my $hxc = ($passed - $ebg - $pbg)/$lumi{$run}->[0];
    my $hxc_err = $hxc * sqrt((1./$passed + &sqr(0.15))/($passed - $ebg - $pbg) +
			      &sqr($lumi{$run}->[1])/&sqr($lumi{$run}->[0]));
    
    print "$e\t$hxc\t$hxc_err\n";
}

sub sqr {@_[0] * @_[0];}
